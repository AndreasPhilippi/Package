===========
Newsvendor
===========

The Newsvendor is a single period inventory problem that refers to a situation in which a seller has to determine the
order quantity of perishable goods for the next selling period, after which left-over stock becomes worthless.
Hence, at the end of the selling period each unit of unsold stock then incurs overage costs of :math:`co` and each unit
of demand that cannot be satisfied incurs underage costs of :math:`cu`. Therefore, the newsvendor wants to choose the
order quantity that minimizes the sum of the expected costs mentioned above.

Given this background, the optimal order quantity for the newsvendor problem can be formulated as follows:

.. math::
    \min_{q\ge 0} = E_D[cu(D-q)^+ + co(q-D)^+],
    \label{nv} \tag{1}

where :math:`D` is the random future demand, :math:`q` is the order qunatity, :math:`cu` and :math:`co` are the
per-unit under- and overage costs and :math:`(\cdot)^+ := \max\{0,\cdot\}`. If the demand distribution is known,
then the optimal decision can be obtained as:

.. math::
    q^*=F^{-1}\biggl(\frac{cu}{cu+co}\biggl)=F^{-1}(\alpha),
    \label{nv_solution} \tag{2}

where :math:`F^{-1}(\cdot)` is the inverse cumulative density function of the demand distribution.

In practice, the decision maker can not directly solve eq. :math:`\ref{nv_solution}`, since he does not know the
true distribution of :math:`D`. If the demand distribution is unknown, there are two main data-driven
approaches to solve the newsvendor problem:

* :ref:`Separate Estimation and Optimization (SEO)`
* :ref:`Joint Estimation and Optimization (JEO)`


.. Separate Estimation and Optimization (SEO):

Separate Estimation and Optimization (SEO)
==========================================
The traditional way of solving the newsvendor problem when the underlying demand distribution is
unknown is to assume that the demand falls in a family of parametric distributions, estimate
the parameters based on historical demands, and then solve the initial optimization problem. This
two-step procedure of first estimating and then optimizing is called separate estimation and
optimization (SEO). However, by doing so the optimal order quantity will be the same for each
period since we assume the demand to be stationary. In many real-world situations this assumption
is not true, as the demand might be seasonal, follow a trend or is influenced by factors like the
weather conditions. Therefore, it is common practice to estimate a demand-forecasting
model, which can take such factors into account, rather than estimating the demand distribution.
Of course we cannot assume our model is perfect: first because of the model error itself, and second,
because of the uncertainty in demand. Consequently, we need to take these errors into account to
obtain optimal order decisions. For this reason, we first calculate the forecasting error of our model
containing both, the model error and the uncertainty in demand. Lets now assume the error is distributed
normal. Then we can estimate the parameters :math:`\mu_{fe}` and :math:`\sigma_{fe}` of the forecasting error,
and pass them to the initial optimization problem (:math:`\ref{nv_solution}`) to determine an additional safety
stock. The final order decision is then the sum of both the forecast generated by our model and the safety stock.

If you want to deep dive into SEO check out the tutorial below.

.. toctree::
    :maxdepth: 1

    notebooks/SEO.ipynb

.. Joint Estimation and Optimization:

Joint Estimation and Optimization (JEO)
=======================================
Even though SEO is a standard and widely adopted approach in practice, it has a major Drawback: By first estimating
the demand and then optimizing the inventory decision, the estimation error may amplify in the optimization step, which
in turn will lead to suboptimal inventory decisions. One approach that can tackle this issue is Joint Estimation and
Optimization (JEO). In contrast to the two step approach of SEO, JEO directly prescribe decisions from data.


Classical JEO approach (SAA)
----------------------------
The classical JEO approach, also referred to as Sample Average Approximation (SAA), estimates optimal decisions
only based on historical demand data by substituting the true expectation with a sample average expectation.
To be more specific, if one has access to N historical demand observations :math:`d(n)=[d_1,...,d_n]`, then the
optimal decision can be obtained by solving the following optimization problem:

.. math::
    \min_{q\ge 0} = \sum_{i=1}^N cu(d_i-q)^+ + co(q-d_i)^+]


Feature driven JEO approach
---------------------------

* weighted SAA
* Empirical Risk Minimization

